<!doctype html>
<html>
<head>
    <base href="/">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="author" content="Francois Teychené">

<meta name="description" content="">

<title>Getting Started with Ansible</title>
<meta name="generator" content="Hugo 0.46" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/pojoaque.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
<link  href="https://fteychene.github.io/vagrant-ansible-epsi/css/theme.min.css" rel="stylesheet" type="text/css">

</head>
<body>
<div class="page-container container-fluid">
<div class="col-md-3 menu">
    <nav class="col-md-3">
    <h3 class="home-link"><a href="https://fteychene.github.io/vagrant-ansible-epsi">Root</a></h3>

    
    <div id="vagrant" class="open">
        <h3 data-open="vagrant">Vagrant</h3>
        <ul>
            
            <li><a href="https://fteychene.github.io/vagrant-ansible-epsi/vagrant/getting_started/">Getting Started with Vagrant</a></li>
            
            <li><a href="https://fteychene.github.io/vagrant-ansible-epsi/vagrant/multi_machine/">Vagrant Multi machine</a></li>
            
        </ul>
    </div>
    

    
    <div id="ansible" class="open">
        <h3 data-open="ansible">Ansible</h3>
        <ul>
            
            <li><a href="https://fteychene.github.io/vagrant-ansible-epsi/ansible/getting_started/">Getting Started with Ansible</a></li>
            
            <li><a href="https://fteychene.github.io/vagrant-ansible-epsi/ansible/inventory/">Inventory</a></li>
            
            <li><a href="https://fteychene.github.io/vagrant-ansible-epsi/ansible/playbook/">Playbook</a></li>
            
        </ul>
    </div>
    
    
    

    
</nav>

</div>
<div class="col-md-9 content">

<h1>Getting Started with Ansible</h1>
<h4>Published 09-09-2018 22:06:59</h4>

<a href="https://twitter.com/share" class="twitter-share-button" data-via="kendo5731"></a>
<script>!function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
    if (!d.getElementById(id)) {
        js = d.createElement(s);
        js.id = id;
        js.src = p + '://platform.twitter.com/widgets.js';
        fjs.parentNode.insertBefore(js, fjs);
    }
}(document, 'script', 'twitter-wjs');</script>

<div class="fb-share-button" data-href="https://fteychene.github.io/vagrant-ansible-epsi/ansible/getting_started/" data-layout="button"></div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en-US/sdk.js#xfbml=1&version=v2.5";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<article>
    

<h1 id="create-target-vm">Create target VM</h1>

<p>Create a fresh VM with <code>vagrant</code> to use ansible on it with the following configuration</p>

<pre><code class="language-ruby">Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.box = &quot;ubuntu/xenial64&quot;

  config.vm.network :private_network, ip: &quot;192.168.0.2&quot;

  config.ssh.forward_agent    = true
  config.ssh.insert_key       = false
  config.ssh.private_key_path =  [&quot;~/.vagrant.d/insecure_private_key&quot;,&quot;~/.ssh/id_rsa&quot;]
  config.vm.provision :shell, privileged: false do |s|
    ssh_pub_key = File.readlines(&quot;#{Dir.home}/.ssh/id_rsa.pub&quot;).first.strip
    s.inline = &lt;&lt;-SHELL
      echo #{ssh_pub_key} &gt;&gt; /home/$USER/.ssh/authorized_keys
      sudo bash -c &quot;echo #{ssh_pub_key} &gt;&gt; /root/.ssh/authorized_keys&quot;
      sudo apt-get update
      sudo apt-get install -y python
    SHELL
  end
end
</code></pre>

<p>Ansible use ssh to connect to target VM and execute command on machines.<br />
This configuration add your local machine ssh keys to the accepted configuration of the custom VM.</p>

<h1 id="installation">Installation</h1>

<p>The instruction for installation can be found <a href="https://docs.ansible.com/ansible/2.5/installation_guide/intro_installation.html">here</a></p>

<h1 id="inventory">Inventory</h1>

<p>Ansible works against multiple systems in your infrastructure at the same time. It does this by selecting portions of systems listed in Ansible’s inventory, which defaults to being saved in the location <code>/etc/ansible/hosts</code>. You can specify a different inventory file using the -i <path> option on the command line.</p>

<p>To work on your new configured VM,  add it&rsquo;s ip to the ansible inventory file <code>/etc/ansible/hosts</code></p>

<pre><code class="language-bash">echo 192.168.0.2 &gt;&gt; /etc/ansible/hosts
</code></pre>

<p>By doing this you add your VM to the global inventory of ansible in the all group (if you don&rsquo;t have already some groupe configured in this file &hellip;).</p>

<p>You can test the connection to your VM with the ansible command, using the <code>ping</code> module.</p>

<pre><code class="language-bash">ansible all -u vagrant -m ping 
</code></pre>

<p>The <code>-u</code> option define the suer to connect with on the VM.<br />
Th <code>-m</code> define the module to be executed on VMs from the all group</p>

<h1 id="connection-user">Connection user</h1>

<p>If you would like to access sudo mode, there are also flags to do that:</p>

<pre><code class="language-bash"># as bruce
$ ansible all -m ping -u bruce
# as bruce, sudoing to root
$ ansible all -m ping -u bruce -b
# as bruce, sudoing to batman
$ ansible all -m ping -u bruce -b --become-user batman
</code></pre>

<p>(The sudo implementation is changeable in Ansible’s configuration file if you happen to want to use a sudo replacement. Flags passed to sudo (like -H) can also be set there.)</p>

<h1 id="ad-hoc-commands">Ad-hoc commands</h1>

<p>Now run a live command on all of your nodes:</p>

<pre><code class="language-bash">$ ansible all -u vagrant -a &quot;/bin/echo hello&quot;
</code></pre>

<p>Congratulations! You’ve just contacted your nodes with Ansible.<br />
It’s soon going to be time to:</p>

<ul>
<li>read about some more real-world cases in Introduction To Ad-Hoc Commands</li>
<li>explore what you can do with different modules</li>
<li>learn about the Ansible Working With Playbooks language. Ansible is not just about running commands, it also has powerful configuration management and deployment features.</li>
</ul>

<p>There’s more to explore, but you already have a fully working infrastructure!</p>

<h1 id="excercice">Excercice</h1>

<p>Start multiple VMs and configure ansible to run <code>hostname</code> to all your VM with one command</p>

</article>



</div>
</div>
<script src="https://fteychene.github.io/vagrant-ansible-epsi/js/theme.min.js" type="text/javascript"></script>


</body>
</html>

